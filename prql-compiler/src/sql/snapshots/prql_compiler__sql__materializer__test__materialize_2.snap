---
source: prql-compiler/src/sql/materializer.rs
expression: mat
---
- Transform:
    From:
      name: employees
      alias: ~
      declared_at: 41
  ty:
    Literal: Table
- Transform:
    Filter:
      Binary:
        left:
          Ident: country
        op: Eq
        right:
          Literal:
            String: USA
          ty:
            Literal: String
      ty: Infer
  ty:
    Function:
      named: {}
      args:
        - Infer
      return_ty:
        Literal: Table
- Transform:
    Filter:
      Binary:
        left:
          Binary:
            left:
              Binary:
                left:
                  Ident: salary
                op: Add
                right:
                  Ident: payroll_tax
              ty: Infer
            op: Add
            right:
              Ident: benefits_cost
          ty: Infer
        op: Gt
        right:
          Literal:
            Integer: 0
          ty:
            Literal: Integer
      ty: Infer
  ty:
    Function:
      named: {}
      args:
        - Infer
      return_ty:
        Literal: Table
- Transform:
    Group:
      by:
        - Ident: title
        - Ident: country
      pipeline:
        Pipeline:
          nodes:
            - Transform:
                Aggregate:
                  assigns:
                    - SString:
                        - String: AVG(
                        - Expr:
                            Ident: salary
                        - String: )
                      ty: Infer
                    - SString:
                        - String: SUM(
                        - Expr:
                            Ident: salary
                        - String: )
                      ty: Infer
                    - SString:
                        - String: AVG(
                        - Expr:
                            Binary:
                              left:
                                Ident: salary
                              op: Add
                              right:
                                Ident: payroll_tax
                        - String: )
                      ty: Infer
                    - SString:
                        - String: SUM(
                        - Expr:
                            Binary:
                              left:
                                Ident: salary
                              op: Add
                              right:
                                Ident: payroll_tax
                        - String: )
                      ty: Infer
                    - SString:
                        - String: AVG(
                        - Expr:
                            Binary:
                              left:
                                Binary:
                                  left:
                                    Ident: salary
                                  op: Add
                                  right:
                                    Ident: payroll_tax
                                ty: Infer
                              op: Add
                              right:
                                Ident: benefits_cost
                        - String: )
                      ty: Infer
                    - SString:
                        - String: SUM(
                        - Expr:
                            Binary:
                              left:
                                Binary:
                                  left:
                                    Ident: salary
                                  op: Add
                                  right:
                                    Ident: payroll_tax
                                ty: Infer
                              op: Add
                              right:
                                Ident: benefits_cost
                        - String: )
                      ty: Infer
                    - SString:
                        - String: COUNT(*)
                      ty: Infer
                  by:
                    - Ident: title
                    - Ident: country
              ty:
                Function:
                  named: {}
                  args:
                    - Infer
                  return_ty:
                    Literal: Table
  ty:
    Function:
      named: {}
      args:
        - Infer
      return_ty:
        Literal: Table
- Transform:
    Filter:
      Binary:
        left:
          SString:
            - String: SUM(
            - Expr:
                Binary:
                  left:
                    Binary:
                      left:
                        Ident: salary
                      op: Add
                      right:
                        Ident: payroll_tax
                    ty: Infer
                  op: Add
                  right:
                    Ident: benefits_cost
            - String: )
          ty: Infer
        op: Gt
        right:
          Literal:
            Integer: 200
          ty:
            Literal: Integer
      ty: Infer
  ty:
    Function:
      named: {}
      args:
        - Infer
      return_ty:
        Literal: Table
- Transform:
    Take:
      range:
        start: ~
        end:
          Literal:
            Integer: 20
      by: []
      sort: []
  ty:
    Function:
      named: {}
      args:
        - Infer
      return_ty:
        Literal: Table

